import unittest

from scanpointgenerator.lissajousgenerator import LissajousGenerator


class LissajousGeneratorTest(unittest.TestCase):

    def setUp(self):
        bounding_box = dict(centre=[0.0, 0.0], width=1.0, height=1.0)
        self.g = LissajousGenerator(['x', 'y'], "mm", bounding_box, 10, [1, 2])

    def test_init(self):
        self.assertEqual(self.g.position_units, dict(x="mm", y="mm"))
        self.assertEqual(self.g.index_dims, [10])
        self.assertEqual(self.g.index_names, ["x", "y"])

    def test_iterator(self):
        positions = [{'y': 0.0, 'x': 0.5},
                     {'y': 0.47552825814757677, 'x': 0.4045084971874737},
                     {'y': 0.2938926261462366, 'x': 0.15450849718747375},
                     {'y': -0.2938926261462365, 'x': -0.15450849718747364},
                     {'y': -0.4755282581475768, 'x': -0.40450849718747367},
                     {'y': -1.2246467991473532e-16, 'x': -0.5},
                     {'y': 0.47552825814757677, 'x': -0.4045084971874738},
                     {'y': 0.2938926261462367, 'x': -0.1545084971874738},
                     {'y': -0.2938926261462364, 'x': 0.1545084971874736},
                     {'y': -0.4755282581475769, 'x': 0.4045084971874736}]
        lower = [{'y': -0.29389262614623657, 'x': 0.47552825814757677},
                 {'y': 0.29389262614623657, 'x': 0.4755282581475768},
                 {'y': 0.4755282581475768, 'x': 0.2938926261462366},
                 {'y': 6.123233995736766e-17, 'x': 6.123233995736766e-17},
                 {'y': -0.47552825814757677, 'x': -0.2938926261462365},
                 {'y': -0.2938926261462367, 'x': -0.47552825814757677},
                 {'y': 0.29389262614623646, 'x': -0.4755282581475768},
                 {'y': 0.4755282581475768, 'x': -0.2938926261462367},
                 {'y': 1.8369701987210297e-16, 'x': -1.2246467991473532e-16},
                 {'y': -0.4755282581475767, 'x': 0.29389262614623646}]
        upper = [{'y': 0.29389262614623657, 'x': 0.4755282581475768},
                 {'y': 0.4755282581475768, 'x': 0.2938926261462366},
                 {'y': 6.123233995736766e-17, 'x': 6.123233995736766e-17},
                 {'y': -0.47552825814757677, 'x': -0.2938926261462365},
                 {'y': -0.2938926261462367, 'x': -0.47552825814757677},
                 {'y': 0.29389262614623646, 'x': -0.4755282581475768},
                 {'y': 0.4755282581475768, 'x': -0.2938926261462367},
                 {'y': 1.8369701987210297e-16, 'x': -1.2246467991473532e-16},
                 {'y': -0.4755282581475767, 'x': 0.29389262614623646},
                 {'y': -0.29389262614623674, 'x': 0.47552825814757677}]
        indexes = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

        for i, p in enumerate(self.g.iterator()):
            self.assertEqual(p.positions, positions[i])
            self.assertEqual(p.lower, lower[i])
            self.assertEqual(p.upper, upper[i])
            self.assertEqual(p.indexes, [indexes[i]])
        self.assertEqual(i, 9)
